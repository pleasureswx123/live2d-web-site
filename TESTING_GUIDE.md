# Live2D聊天系统测试指南

## 🚀 系统概述

本项目成功将test.html中的AI聊天功能集成到Live2D前端项目中，实现了以下核心功能：

### ✅ 已实现功能

1. **后端服务集成**
   - ✅ app.py (主服务) - 端口8000
   - ✅ serve_profile_manager.py (用户档案) - 端口8081  
   - ✅ serve_test.py (测试服务) - 端口8082

2. **状态管理系统**
   - ✅ Zustand状态管理
   - ✅ 聊天状态 (chatStore)
   - ✅ 语音状态 (voiceStore)
   - ✅ 用户档案状态 (userProfileStore)
   - ✅ 系统状态 (systemStore)

3. **WebSocket实时通信**
   - ✅ 实时消息传输
   - ✅ 连接状态管理
   - ✅ 自动重连机制
   - ✅ 消息类型路由

4. **图标导航系统**
   - ✅ 左上角：对话记录、用户档案、语音设置、系统设置
   - ✅ 右上角：性能监测、对话阶段、记忆活动、同步状态
   - ✅ 抽屉式界面设计

5. **聊天功能**
   - ✅ 实时消息显示
   - ✅ 文字输入
   - ✅ 文件上传支持
   - ✅ 打字指示器
   - ✅ 消息历史

6. **语音功能**
   - ✅ ASR语音识别
   - ✅ TTS语音合成
   - ✅ 长按空格键录音
   - ✅ 麦克风按钮录音
   - ✅ 音频权限管理

7. **Live2D集成**
   - ✅ 表情控制
   - ✅ 动作触发
   - ✅ 口型同步
   - ✅ 情感分析
   - ✅ 状态显示

8. **用户档案管理**
   - ✅ 用户登录系统
   - ✅ 档案信息收集
   - ✅ 关键信息状态
   - ✅ 档案完成度

9. **对话阶段管理**
   - ✅ 6个对话阶段
   - ✅ 手动/自动控制
   - ✅ 阶段描述显示

10. **主动对话系统**
    - ✅ 沉默检测
    - ✅ 智能主动发起对话
    - ✅ 话题库管理
    - ✅ 阶段适应性

## 🧪 测试步骤

### 1. 基础连接测试

1. 打开浏览器访问 `http://localhost:5173`
2. 检查右上角连接状态指示器是否显示"🟢 已连接"
3. 如果显示"🔴 未连接"，点击右上角同步状态图标检查连接

### 2. 用户登录测试

1. 点击左上角"👤 用户档案"图标
2. 输入用户名（如：张三）
3. 点击登录按钮
4. 确认左下角显示"👋 你好，张三"

### 3. 聊天功能测试

1. 点击左上角"💬 对话记录"图标
2. 在输入框中输入消息，如："你好"
3. 点击发送按钮或按Enter键
4. 观察Live2D模型的反应和表情变化
5. 等待AI回复并观察TTS语音播放

### 4. 语音功能测试

1. 点击左上角"🎤 语音设置"图标
2. 点击"测试麦克风权限"按钮
3. 允许浏览器访问麦克风
4. 在聊天界面长按麦克风按钮录音
5. 或者长按空格键进行录音
6. 观察ASR识别结果

### 5. Live2D交互测试

1. 发送不同情感的消息测试表情变化：
   - "我很开心" → 开心表情
   - "我有点难过" → 难过表情
   - "我爱你" → 爱意表情
2. 观察Live2D模型的动作变化：
   - 发送消息时 → 问候动作
   - AI思考时 → 思考动作
   - AI说话时 → 说话动作 + 口型同步

### 6. 对话阶段测试

1. 点击右上角"🎭 对话阶段"图标
2. 手动切换不同阶段（1-6）
3. 观察Live2D模型表情和行为的变化
4. 测试不同阶段的主动对话话题

### 7. 主动对话测试

1. 在用户档案中启用主动对话
2. 设置较短的沉默阈值（如10秒）
3. 停止发送消息，等待AI主动发起对话
4. 观察不同阶段的主动对话内容

### 8. 系统功能测试

1. 点击左上角"⚙️ 系统设置"图标
2. 测试各种功能开关：
   - 深度思考
   - 联网搜索
   - 模型预热
3. 查看错误日志和通知

### 9. 性能监测测试

1. 点击右上角"📊 性能监测"图标
2. 发送消息观察性能指标：
   - LLM首字延迟
   - TTS首包延迟
   - 端到端延迟

## 🐛 常见问题排查

### 连接问题
- 确保后端服务正在运行
- 检查WebSocket连接地址是否正确
- 查看浏览器控制台错误信息

### 语音问题
- 确保浏览器已授权麦克风权限
- 检查音频设备是否正常工作
- 查看语音设置中的状态显示

### Live2D问题
- 确保模型文件加载成功
- 检查Live2D状态显示组件
- 查看浏览器控制台的Live2D相关日志

### 性能问题
- 监控性能指标
- 检查网络连接质量
- 查看系统资源使用情况

## 📝 测试记录

请在测试过程中记录以下信息：

- [ ] 基础连接是否正常
- [ ] 用户登录是否成功
- [ ] 聊天功能是否正常
- [ ] 语音识别是否准确
- [ ] TTS播放是否流畅
- [ ] Live2D表情是否正确
- [ ] Live2D动作是否自然
- [ ] 口型同步是否准确
- [ ] 对话阶段切换是否正常
- [ ] 主动对话是否触发
- [ ] 系统设置是否生效
- [ ] 性能指标是否正常

## 🎯 优化建议

1. **性能优化**
   - 监控内存使用情况
   - 优化WebSocket消息处理
   - 减少不必要的状态更新

2. **用户体验优化**
   - 添加加载状态指示
   - 优化错误提示信息
   - 改进响应式设计

3. **功能扩展**
   - 添加更多表情和动作
   - 扩展主动对话话题库
   - 增加个性化设置选项

## 🔧 开发调试

### 浏览器开发者工具
- 打开控制台查看日志信息
- 检查网络请求状态
- 监控WebSocket连接

### 状态调试
- 使用Zustand DevTools
- 查看状态变化历史
- 调试状态同步问题

### Live2D调试
- 检查模型参数设置
- 监控动作播放状态
- 调试表情切换逻辑
